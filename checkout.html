<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</title>
  <style>
    body {font-family: "Segoe UI", sans-serif; background:#f5f7fa; margin:0; padding:0;}
    header {background:#2c3e50; color:#fff; padding:15px; font-size:20px; text-align:center;}
    main {max-width:800px; margin:30px auto; background:#fff; border-radius:12px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,.1);}
    h2 {margin-bottom:15px; color:#2c3e50;}
    .order-item {display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding:10px 0;}
    .order-item:last-child{border-bottom:none;}
    .muted{color:#777; font-size:14px;}
    .summary{text-align:left; margin-top:20px; font-size:18px;}
    .btn{margin-top:20px; display:block; width:100%; background:#27ae60; color:#fff; padding:14px; border:none; border-radius:8px; font-size:18px; cursor:pointer;}
    .btn:hover{background:#219150;}
    .empty{text-align:center; color:#888; padding:30px 0; font-size:18px;}
    .success{text-align:center; color:#27ae60; font-size:20px; margin-top:20px;}
  </style>
</head>
<body>
  <header>âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</header>
  <main>
    <h2>Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ù„Ø©</h2>
    <div id="orderItems"></div>
    <div class="summary">
      Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="orderTotal">0</span> Ø±ÙŠØ§Ù„
    </div>
    <button class="btn" id="confirmOrder">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
    <div id="successMsg" class="success" style="display:none;">ğŸ‰ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!</div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get, set, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      databaseURL: "https://appjx-d8c22-default-rtdb.firebaseio.com/"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const orderItems = document.getElementById('orderItems');
    const orderTotalEl = document.getElementById('orderTotal');
    const confirmBtn = document.getElementById('confirmOrder');
    const successMsg = document.getElementById('successMsg');

    let cart = {};
    let total = 0;

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø© Ù…Ù† Firebase
    async function loadCart(){
      const snap = await get(ref(db, "cart"));
      cart = snap.exists() ? snap.val() : {};
      renderOrder();
    }

    // Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨
    function renderOrder(){
      orderItems.innerHTML = '';
      total = 0;
      for (const [id, item] of Object.entries(cart)) {
        const qty = Number(item.qty) || 0;
        const price = Number(item.price) || 0;
        total += qty * price;
        const div = document.createElement('div');
        div.className = 'order-item';
        div.innerHTML = `
          <div>
            <strong>${item.name}</strong>
            <div class="muted">${price} Ø±ÙŠØ§Ù„ Ã— ${qty}</div>
          </div>
          <div><strong>${(price*qty).toFixed(2)}</strong> Ø±ÙŠØ§Ù„</div>`;
        orderItems.appendChild(div);
      }
      if (!Object.keys(cart).length) {
        orderItems.innerHTML = '<div class="empty">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>';
        confirmBtn.style.display = "none";
      }
      orderTotalEl.textContent = total.toFixed(2);
    }

    // Ø¹Ù†Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
    confirmBtn.onclick = async function(){
      if (!Object.keys(cart).length) return;
      const orderData = {
        items: cart,
        total: total,
        date: new Date().toLocaleString()
      };
      await push(ref(db, "orders"), orderData);
      await set(ref(db, "cart"), {}); // ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©
      successMsg.style.display = "block";
      orderItems.innerHTML = "";
      orderTotalEl.textContent = "0";
      confirmBtn.style.display = "none";
    };

    loadCart();
  </script>
</body>
</html>
